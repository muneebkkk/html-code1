<div class="row mb-4">
  <div class="col-12">
    <h3 class="mb-2"><i class="fas fa-clipboard-list me-2"></i>All Orders</h3>
    <p class="text-muted mb-0">View and manage all customer orders. Change order status to track the lifecycle.</p>
  </div>
</div>

<% if (typeof totalOrders !== 'undefined' && totalOrders > 0) { %>
  <div class="row mb-4">
    <div class="col-md-3">
      <div class="card bg-primary text-white mb-3">
        <div class="card-body">
          <div class="d-flex justify-content-between align-items-center">
            <div>
              <h6 class="card-subtitle mb-1">Total Orders</h6>
              <h4 class="mb-0"><%= totalOrders %></h4>
            </div>
            <i class="fas fa-shopping-cart fa-2x opacity-50"></i>
          </div>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card bg-warning text-white mb-3">
        <div class="card-body">
          <div class="d-flex justify-content-between align-items-center">
            <div>
              <h6 class="card-subtitle mb-1">Placed</h6>
              <h4 class="mb-0"><%= placedCount %></h4>
            </div>
            <i class="fas fa-hourglass-half fa-2x opacity-50"></i>
          </div>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card bg-info text-white mb-3">
        <div class="card-body">
          <div class="d-flex justify-content-between align-items-center">
            <div>
              <h6 class="card-subtitle mb-1">Processing</h6>
              <h4 class="mb-0"><%= processingCount %></h4>
            </div>
            <i class="fas fa-spinner fa-2x opacity-50"></i>
          </div>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card bg-success text-white mb-3">
        <div class="card-body">
          <div class="d-flex justify-content-between align-items-center">
            <div>
              <h6 class="card-subtitle mb-1">Delivered</h6>
              <h4 class="mb-0"><%= deliveredCount %></h4>
            </div>
            <i class="fas fa-check-circle fa-2x opacity-50"></i>
          </div>
        </div>
      </div>
    </div>
  </div>
<% } %>

<% if (typeof flash !== 'undefined' && flash) { %>
  <div class="alert alert-<%= flash.type %> alert-dismissible fade show" role="alert">
    <i class="fas fa-<%= flash.type === 'success' ? 'check-circle' : 'exclamation-circle' %> me-2"></i>
    <%= flash.message %>
    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
  </div>
<% } %>

<div class="card shadow-sm">
  <div class="card-body">
    <% if (orders && orders.length > 0) { %>
      <div class="table-responsive">
        <table class="table table-hover align-middle mb-0">
          <thead class="table-light">
            <tr>
              <th style="width: 200px;">Order ID</th>
              <th>Customer Email</th>
              <th>Items</th>
              <th>Date Placed</th>
              <th>Total Amount</th>
              <th>Status</th>
              <th style="width: 200px;">Actions</th>
            </tr>
          </thead>
          <tbody>
            <% orders.forEach(function(order) { %>
              <tr>
                <td>
                  <code style="background: #f0f0f0; padding: 4px 8px; border-radius: 4px; font-size: 0.85rem;">
                    <%= order._id.toString().substring(0, 8) %>...
                  </code>
                  <br>
                  <small class="text-muted" style="font-size: 0.75rem;">
                    <i class="fas fa-calendar me-1"></i><%= order.createdAt.toLocaleDateString() %>
                  </small>
                </td>
                <td>
                  <i class="fas fa-envelope me-2 text-muted"></i>
                  <strong><%= order.email %></strong>
                </td>
                <td>
                  <span class="badge bg-info">
                    <i class="fas fa-box me-1"></i><%= order.items.length %> item(s)
                  </span>
                  <% if (order.items.length > 0) { %>
                    <br>
                    <small class="text-muted" style="font-size: 0.85rem;">
                      <%= order.items[0].name %>
                      <% if (order.items.length > 1) { %>
                        +<%= order.items.length - 1 %> more
                      <% } %>
                    </small>
                  <% } %>
                </td>
                <td>
                  <i class="fas fa-clock me-2 text-muted"></i>
                  <%= order.createdAt.toLocaleString() %>
                </td>
                <td>
                  <strong class="text-success">$<%= order.totalAmount.toFixed(2) %></strong>
                  <% if (order.discountAmount > 0) { %>
                    <br>
                    <small class="text-muted" style="font-size: 0.85rem;">
                      Discount: -$<%= order.discountAmount.toFixed(2) %>
                    </small>
                  <% } %>
                </td>
                <td>
                  <% 
                    let statusClass = 'bg-secondary';
                    let statusIcon = 'fa-clock';
                    if (order.status === 'Delivered') {
                      statusClass = 'bg-success';
                      statusIcon = 'fa-check-circle';
                    } else if (order.status === 'Processing') {
                      statusClass = 'bg-primary';
                      statusIcon = 'fa-spinner';
                    } else {
                      statusClass = 'bg-warning';
                      statusIcon = 'fa-hourglass-half';
                    }
                  %>
                  <span class="badge <%= statusClass %>">
                    <i class="fas <%= statusIcon %> me-1"></i><%= order.status %>
                  </span>
                </td>
                <td>
                  <% let nextStatus = null;
                     if (order.status === "Placed") nextStatus = "Processing";
                     else if (order.status === "Processing") nextStatus = "Delivered";
                  %>
                  <% if (nextStatus) { %>
                    <form
                      action="/super-admin/orders/<%= order._id %>/status"
                      method="POST"
                      class="d-inline"
                      onsubmit="return confirm('Change order status from <%= order.status %> to <%= nextStatus %>?');"
                    >
                      <input type="hidden" name="status" value="<%= nextStatus %>" />
                      <button type="submit" class="btn btn-sm btn-primary">
                        <i class="fas fa-arrow-right me-1"></i>Mark as <%= nextStatus %>
                      </button>
                    </form>
                  <% } else { %>
                    <span class="badge bg-success">
                      <i class="fas fa-check-circle me-1"></i>Completed
                    </span>
                  <% } %>
                </td>
              </tr>
            <% }); %>
          </tbody>
        </table>
      </div>
      
      <div class="mt-3 text-muted">
        <small>
          <i class="fas fa-info-circle me-1"></i>
          Total Orders: <strong><%= orders.length %></strong>
        </small>
      </div>
    <% } else { %>
      <div class="text-center py-5">
        <i class="fas fa-inbox fa-3x text-muted mb-3"></i>
        <p class="text-muted mb-0">No orders have been placed yet.</p>
      </div>
    <% } %>
  </div>
</div>


